<%- include('partials/header') %>
<%- include('partials/nav') %>

<%
  // Calcul des statistiques
  const totalLogs = items.length;
  const createCount = items.filter(i => i.action === 'create').length;
  const updateCount = items.filter(i => i.action === 'update').length;
  const deleteCount = items.filter(i => i.action === 'delete').length;
  
  // Statistiques par entit√©
  const entityStats = {};
  items.forEach(i => {
    if (i.entity) {
      entityStats[i.entity] = (entityStats[i.entity] || 0) + 1;
    }
  });
  
  // Activit√© r√©cente (derni√®res 24h)
  const now = new Date();
  const last24h = new Date(now - 24 * 60 * 60 * 1000);
  const recentActivity = items.filter(i => i.createdAt && new Date(i.createdAt) > last24h).length;
  
  // Acteurs uniques
  const uniqueActors = new Set(items.map(i => i.actorEmail || i.actorId).filter(Boolean));
%>

<div class="admin-console">
  <!-- Header Premium avec Glassmorphism -->
  <div class="admin-header">
    <div class="admin-header__content">
      <div class="admin-header__left">
        <div class="admin-badge">
          <svg class="icon-pulse" width="12" height="12" viewBox="0 0 12 12">
            <circle cx="6" cy="6" r="5" fill="currentColor"/>
          </svg>
          Console Administrateur
        </div>
        <h1 class="admin-title">
          <span class="title-gradient">Centre de Contr√¥le</span>
        </h1>
        <p class="admin-subtitle">Surveillance et audit en temps r√©el des op√©rations</p>
      </div>
      <div class="admin-header__right">
        <div class="user-card">
          <div class="user-avatar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <div>
            <div class="user-name"><%= user && user.email ? user.email : 'Admin' %></div>
            <div class="user-role">Super Admin</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard KPI Cards -->
  <div class="kpi-grid">
    <div class="kpi-card kpi-card--primary">
      <div class="kpi-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 11l3 3L22 4"></path>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Total Actions</div>
        <div class="kpi-value animate-count" data-target="<%= totalLogs %>">0</div>
        <div class="kpi-trend positive">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <polyline points="18 15 12 9 6 15"></polyline>
          </svg>
          Derni√®re limite charg√©e
        </div>
      </div>
    </div>

    <div class="kpi-card kpi-card--success">
      <div class="kpi-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Cr√©ations</div>
        <div class="kpi-value animate-count" data-target="<%= createCount %>">0</div>
        <% const createPercent = totalLogs > 0 ? (createCount / totalLogs * 100) : 0; %>
        <div class="kpi-progress">
          <div class="kpi-progress-bar" data-width="<%= createPercent %>"></div>
        </div>
      </div>
    </div>

    <div class="kpi-card kpi-card--warning">
      <div class="kpi-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Modifications</div>
        <div class="kpi-value animate-count" data-target="<%= updateCount %>">0</div>
        <% const updatePercent = totalLogs > 0 ? (updateCount / totalLogs * 100) : 0; %>
        <div class="kpi-progress">
          <div class="kpi-progress-bar" data-width="<%= updatePercent %>"></div>
        </div>
      </div>
    </div>

    <div class="kpi-card kpi-card--danger">
      <div class="kpi-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Suppressions</div>
        <div class="kpi-value animate-count" data-target="<%= deleteCount %>">0</div>
        <% const deletePercent = totalLogs > 0 ? (deleteCount / totalLogs * 100) : 0; %>
        <div class="kpi-progress">
          <div class="kpi-progress-bar" data-width="<%= deletePercent %>"></div>
        </div>
      </div>
    </div>

    <div class="kpi-card kpi-card--info">
      <div class="kpi-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2a10 10 0 1 0 0 20 10 10 0 1 0 0-20z"></path>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Activit√© 24h</div>
        <div class="kpi-value animate-count" data-target="<%= recentActivity %>">0</div>
        <% const activityTrend = recentActivity > 10 ? 'positive' : 'neutral'; %>
        <div class="kpi-trend <%= activityTrend %>">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
          </svg>
          En temps r√©el
        </div>
      </div>
    </div>

    <div class="kpi-card kpi-card--accent">
      <div class="kpi-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Acteurs Uniques</div>
        <div class="kpi-value animate-count" data-target="<%= uniqueActors.size %>">0</div>
        <div class="kpi-trend neutral">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <circle cx="12" cy="12" r="10"></circle>
          </svg>
          Utilisateurs actifs
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-grid">
    <div class="chart-card">
      <div class="chart-header">
        <h3>Distribution des Actions</h3>
        <div class="chart-legend">
          <span class="legend-item legend-create">Cr√©er</span>
          <span class="legend-item legend-update">Modifier</span>
          <span class="legend-item legend-delete">Supprimer</span>
        </div>
      </div>
      <div class="chart-donut">
        <svg viewBox="0 0 200 200" class="donut-chart">
          <% 
            const total = createCount + updateCount + deleteCount || 1;
            const createPercent = (createCount / total) * 100;
            const updatePercent = (updateCount / total) * 100;
            const deletePercent = (deleteCount / total) * 100;
            
            const radius = 70;
            const circumference = 2 * Math.PI * radius;
            
            let offset1 = 0;
            let offset2 = (createPercent / 100) * circumference;
            let offset3 = offset2 + (updatePercent / 100) * circumference;
          %>
          <circle cx="100" cy="100" r="<%= radius %>" fill="none" stroke="#22c55e" stroke-width="30" 
            stroke-dasharray="<%= (createPercent / 100) * circumference %> <%= circumference %>"
            stroke-dashoffset="0" transform="rotate(-90 100 100)" class="chart-segment" />
          <circle cx="100" cy="100" r="<%= radius %>" fill="none" stroke="#3b82f6" stroke-width="30" 
            stroke-dasharray="<%= (updatePercent / 100) * circumference %> <%= circumference %>"
            stroke-dashoffset="<%= -offset2 %>" transform="rotate(-90 100 100)" class="chart-segment" />
          <circle cx="100" cy="100" r="<%= radius %>" fill="none" stroke="#ef4444" stroke-width="30" 
            stroke-dasharray="<%= (deletePercent / 100) * circumference %> <%= circumference %>"
            stroke-dashoffset="<%= -offset3 %>" transform="rotate(-90 100 100)" class="chart-segment" />
          <text x="100" y="95" text-anchor="middle" class="chart-total-label">Total</text>
          <text x="100" y="115" text-anchor="middle" class="chart-total-value"><%= total %></text>
        </svg>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <h3>Activit√© par Entit√©</h3>
      </div>
      <div class="chart-bars">
        <% 
        const maxCount = Object.values(entityStats).length > 0 ? Math.max(...Object.values(entityStats)) : 1;
        Object.entries(entityStats).sort((a, b) => b[1] - a[1]).slice(0, 5).forEach(function([entity, count]) { const barWidth = (count / maxCount) * 100;
        %>
          <div class="bar-item">
            <div class="bar-label"><%= entity %></div>
            <div class="bar-track">
              <div class="bar-fill animate-bar" data-width="<%= barWidth %>">
                <span class="bar-value"><%= count %></span>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
  </div>

  <!-- Filtres Avanc√©s -->
  <div class="filter-panel">
    <div class="filter-header">
      <h3>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        Filtres Avanc√©s
      </h3>
      <button class="filter-toggle" id="toggleFilters">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </button>
    </div>
    <div class="filter-content" id="filterContent">
      <form method="get" action="/admin" class="filters-form">
        <div class="filter-row">
          <div class="filter-field">
            <label>Action</label>
            <select name="action">
              <option value="">Toutes les actions</option>
              <% actions.forEach(function (a) { %>
                <option value="<%= a %>" <%= filters.action === a ? 'selected' : '' %>><%= a %></option>
              <% }) %>
            </select>
          </div>
          <div class="filter-field">
            <label>Entit√©</label>
            <select name="entity">
              <option value="">Toutes les entit√©s</option>
              <% entities.forEach(function (e) { %>
                <option value="<%= e %>" <%= filters.entity === e ? 'selected' : '' %>><%= e %></option>
              <% }) %>
            </select>
          </div>
          <div class="filter-field">
            <label>Acteur</label>
            <input type="text" name="actor" value="<%= filters.actor %>" placeholder="Email de l'acteur" />
          </div>
          <div class="filter-field">
            <label>Recherche</label>
            <input type="text" name="q" value="<%= filters.q %>" placeholder="ID, IP, d√©tails..." id="searchInput" />
          </div>
        </div>
        <div class="filter-row">
          <div class="filter-field">
            <label>Date de d√©but</label>
            <input type="date" name="from" value="<%= filters.from %>" />
          </div>
          <div class="filter-field">
            <label>Date de fin</label>
            <input type="date" name="to" value="<%= filters.to %>" />
          </div>
          <div class="filter-field">
            <label>Limite</label>
            <input type="number" name="limit" min="50" max="1000" value="<%= filters.limit %>" />
          </div>
          <div class="filter-actions">
            <button class="btn-filter btn-primary" type="submit">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              Filtrer
            </button>
            <a class="btn-filter btn-secondary" href="/admin">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                <path d="M21 3v5h-5"></path>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                <path d="M3 21v-5h5"></path>
              </svg>
              Reset
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Table Interactive Premium -->
  <div class="data-table-container">
    <div class="table-header">
      <h3>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        Journal d'Audit (<span id="rowCount"><%= items.length %></span> entr√©es)
      </h3>
      <div class="table-actions">
        <button class="btn-action" onclick="exportTableToCSV()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export CSV
        </button>
      </div>
    </div>
    
    <div class="table-wrapper">
      <table class="data-table" id="auditTable">
        <thead>
          <tr>
            <th class="sortable" data-sort="date">
              Date
              <svg class="sort-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="18 15 12 9 6 15"></polyline>
              </svg>
            </th>
            <th class="sortable" data-sort="action">
              Action
              <svg class="sort-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="18 15 12 9 6 15"></polyline>
              </svg>
            </th>
            <th class="sortable" data-sort="entity">
              Entit√©
              <svg class="sort-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="18 15 12 9 6 15"></polyline>
              </svg>
            </th>
            <th>ID</th>
            <th class="sortable" data-sort="actor">
              Acteur
              <svg class="sort-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="18 15 12 9 6 15"></polyline>
              </svg>
            </th>
            <th>IP</th>
            <th>D√©tails</th>
          </tr>
        </thead>
        <tbody>
          <% if (!items.length) { %>
            <tr class="empty-row">
              <td colspan="7">
                <div class="empty-state">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                  </svg>
                  <p>Aucune action enregistr√©e</p>
                </div>
              </td>
            </tr>
          <% } %>

          <% items.forEach(function (item, index) { const animDelay = Math.min(index * 0.02, 1); %>
            <tr class="table-row animate-row" data-delay="<%= animDelay %>">
              <td class="cell-date">
                <div class="date-wrapper">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <%= item.createdAt ? new Date(item.createdAt).toLocaleString('fr-FR') : '-' %>
                </div>
              </td>
              <td>
                <span class="tag tag--<%= item.action %>">
                  <% if (item.action === 'create') { %>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  <% } else if (item.action === 'update') { %>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  <% } else if (item.action === 'delete') { %>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  <% } %>
                  <%= item.action %>
                </span>
              </td>
              <td><span class="entity-badge"><%= item.entity %></span></td>
              <td><code class="entity-id"><%= item.entityId || '-' %></code></td>
              <td class="cell-actor">
                <div class="actor-wrapper">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <%= item.actorEmail || item.actorId || '-' %>
                </div>
              </td>
              <td><code class="ip-address"><%= item.ip || '-' %></code></td>
              <td>
                <button class="btn-details" onclick="toggleDetails(this, '<%= index %>')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                  Voir
                </button>
                <div class="details-panel" id="details-<%= index %>" style="display: none;">
                  <pre class="json-viewer"><%= JSON.stringify(item.changes || {}, null, 2) %></pre>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
@import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap");

:root {
  --gold-50: #fffbeb;
  --gold-100: #fef3c7;
  --gold-200: #fde68a;
  --gold-300: #fcd34d;
  --gold-400: #fbbf24;
  --gold-500: #f59e0b;
  --gold-600: #d97706;
  --gold-700: #b45309;
  --gold-800: #92400e;
  --bronze-400: #cd7f32;
  --bronze-500: #b87333;
  --silver-400: #c0c0c0;
  --silver-500: #a8a8a8;
}

* {
  box-sizing: border-box;
}

.admin-console {
  font-family: "Inter", -apple-system, system-ui, sans-serif;
  max-width: 1600px;
  margin: 0 auto;
  padding: 32px 24px;
  color: #e5e7eb;
}

/* ===== HEADER PREMIUM ===== */
.admin-header {
  position: relative;
  margin-bottom: 40px;
  padding: 48px 40px;
  border-radius: 24px;
  background: 
    linear-gradient(135deg, rgba(251, 191, 36, 0.05) 0%, rgba(217, 119, 6, 0.03) 100%),
    linear-gradient(180deg, rgba(15, 23, 42, 0.8) 0%, rgba(15, 23, 42, 0.95) 100%);
  backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(251, 191, 36, 0.15);
  box-shadow: 
    0 20px 60px -15px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(251, 191, 36, 0.08),
    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
  overflow: hidden;
}

.admin-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--gold-400), transparent);
}

.admin-header__content {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 32px;
  flex-wrap: wrap;
}

.admin-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border-radius: 999px;
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(217, 119, 6, 0.1));
  border: 1px solid rgba(251, 191, 36, 0.25);
  color: var(--gold-300);
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.1);
}

.icon-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.admin-title {
  margin: 16px 0 8px;
  font-size: 42px;
  font-weight: 800;
  line-height: 1.1;
  letter-spacing: -0.02em;
}

.title-gradient {
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.admin-subtitle {
  margin: 0;
  font-size: 16px;
  color: rgba(229, 231, 235, 0.65);
  font-weight: 400;
}

.user-card {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 20px;
  border-radius: 16px;
  background: rgba(15, 23, 42, 0.6);
  border: 1px solid rgba(251, 191, 36, 0.2);
  backdrop-filter: blur(10px);
}

.user-avatar {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(217, 119, 6, 0.15));
  border: 1px solid rgba(251, 191, 36, 0.3);
  color: var(--gold-300);
}

.user-name {
  font-weight: 600;
  font-size: 14px;
  color: #f9fafb;
}

.user-role {
  font-size: 12px;
  color: var(--gold-400);
  font-weight: 500;
}

/* ===== KPI CARDS ===== */
.kpi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.kpi-card {
  position: relative;
  padding: 24px;
  border-radius: 20px;
  background: 
    linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95)),
    radial-gradient(circle at top right, rgba(59, 130, 246, 0.08), transparent);
  backdrop-filter: blur(10px) saturate(150%);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 
    0 10px 40px -10px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
}

.kpi-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, currentColor, transparent);
  opacity: 0.5;
}

.kpi-card:hover {
  transform: translateY(-4px);
  box-shadow: 
    0 20px 50px -10px rgba(0, 0, 0, 0.5),
    inset 0 1px 0 rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.12);
}

.kpi-card--primary { color: var(--gold-400); }
.kpi-card--success { color: #22c55e; }
.kpi-card--warning { color: #3b82f6; }
.kpi-card--danger { color: #ef4444; }
.kpi-card--info { color: #06b6d4; }
.kpi-card--accent { color: #a855f7; }

.kpi-icon {
  display: inline-flex;
  padding: 12px;
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.05);
  margin-bottom: 16px;
}

.kpi-label {
  font-size: 13px;
  font-weight: 500;
  color: rgba(229, 231, 235, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 8px;
}

.kpi-value {
  font-size: 36px;
  font-weight: 800;
  line-height: 1;
  margin-bottom: 12px;
  background: linear-gradient(135deg, currentColor, rgba(255, 255, 255, 0.8));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.kpi-trend {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 500;
  color: rgba(229, 231, 235, 0.7);
}

.kpi-trend.positive { color: #22c55e; }
.kpi-trend.negative { color: #ef4444; }
.kpi-trend.neutral { color: rgba(229, 231, 235, 0.5); }

.kpi-progress {
  width: 100%;
  height: 4px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 999px;
  overflow: hidden;
  margin-top: 12px;
}

.kpi-progress-bar {
  height: 100%;
  background: linear-gradient(90deg, currentColor, rgba(255, 255, 255, 0.6));
  border-radius: 999px;
  transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ===== CHARTS ===== */
.charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

.chart-card {
  padding: 28px;
  border-radius: 20px;
  background: 
    linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95));
  backdrop-filter: blur(10px);
  border: 1px solid rgba(251, 191, 36, 0.12);
  box-shadow: 
    0 10px 40px -10px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.chart-header {
  margin-bottom: 24px;
}

.chart-header h3 {
  margin: 0 0 12px;
  font-size: 18px;
  font-weight: 700;
  color: #f9fafb;
}

.chart-legend {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  font-weight: 500;
  color: rgba(229, 231, 235, 0.7);
}

.legend-item::before {
  content: '';
  width: 12px;
  height: 12px;
  border-radius: 3px;
}

.legend-create::before { background: #22c55e; }
.legend-update::before { background: #3b82f6; }
.legend-delete::before { background: #ef4444; }

.chart-donut {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.donut-chart {
  max-width: 240px;
  width: 100%;
  filter: drop-shadow(0 4px 20px rgba(0, 0, 0, 0.3));
}

.chart-segment {
  transition: all 0.3s ease;
}

.chart-total-label {
  fill: rgba(229, 231, 235, 0.5);
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.chart-total-value {
  fill: #fbbf24;
  font-size: 24px;
  font-weight: 800;
}

.chart-bars {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.bar-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.bar-label {
  font-size: 13px;
  font-weight: 600;
  color: rgba(229, 231, 235, 0.8);
  text-transform: capitalize;
}

.bar-track {
  position: relative;
  height: 32px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  overflow: hidden;
}

.bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--gold-500), var(--gold-300));
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding: 0 12px;
  transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 10px rgba(251, 191, 36, 0.3);
}

.bar-value {
  font-size: 13px;
  font-weight: 700;
  color: #000;
}

/* ===== FILTER PANEL ===== */
.filter-panel {
  margin-bottom: 32px;
  border-radius: 20px;
  background: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.08);
  overflow: hidden;
}

.filter-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 28px;
  background: rgba(15, 23, 42, 0.8);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  cursor: pointer;
  transition: background 0.2s;
}

.filter-header:hover {
  background: rgba(15, 23, 42, 0.9);
}

.filter-header h3 {
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 16px;
  font-weight: 700;
  color: var(--gold-300);
}

.filter-toggle {
  background: none;
  border: none;
  color: rgba(229, 231, 235, 0.6);
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  transition: all 0.2s;
}

.filter-toggle:hover {
  background: rgba(255, 255, 255, 0.05);
  color: var(--gold-400);
}

.filter-toggle svg {
  transition: transform 0.3s;
}

.filter-toggle.active svg {
  transform: rotate(180deg);
}

.filter-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.filter-content.open {
  max-height: 600px;
}

.filters-form {
  padding: 28px;
}

.filter-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.filter-row:last-child {
  margin-bottom: 0;
}

.filter-field label {
  display: block;
  margin-bottom: 8px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: rgba(229, 231, 235, 0.6);
}

.filter-field input,
.filter-field select {
  width: 100%;
  padding: 12px 14px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(15, 23, 42, 0.6);
  color: #e5e7eb;
  font-size: 14px;
  font-family: inherit;
  transition: all 0.2s;
}

.filter-field input:focus,
.filter-field select:focus {
  outline: none;
  border-color: var(--gold-400);
  box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
  background: rgba(15, 23, 42, 0.8);
}

.filter-actions {
  display: flex;
  gap: 12px;
  align-items: end;
}

.btn-filter {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  border-radius: 12px;
  border: none;
  font-size: 14px;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(135deg, var(--gold-500), var(--gold-600));
  color: #000;
  box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 24px rgba(251, 191, 36, 0.4);
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.05);
  color: rgba(229, 231, 235, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.btn-secondary:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.15);
}

/* ===== DATA TABLE ===== */
.data-table-container {
  border-radius: 20px;
  background: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.08);
  overflow: hidden;
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px 28px;
  background: rgba(15, 23, 42, 0.8);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.table-header h3 {
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 18px;
  font-weight: 700;
  color: #f9fafb;
}

.table-actions {
  display: flex;
  gap: 12px;
}

.btn-action {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  border-radius: 10px;
  border: 1px solid rgba(251, 191, 36, 0.3);
  background: rgba(251, 191, 36, 0.1);
  color: var(--gold-300);
  font-size: 13px;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-action:hover {
  background: rgba(251, 191, 36, 0.15);
  border-color: var(--gold-400);
  transform: translateY(-1px);
}

.table-wrapper {
  overflow-x: auto;
  max-height: 800px;
}

.data-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  font-size: 14px;
}

.data-table thead {
  position: sticky;
  top: 0;
  z-index: 10;
  background: rgba(15, 23, 42, 0.95);
  backdrop-filter: blur(10px);
}

.data-table th {
  padding: 16px;
  text-align: left;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--gold-300);
  border-bottom: 2px solid rgba(251, 191, 36, 0.2);
  white-space: nowrap;
}

.data-table th.sortable {
  cursor: pointer;
  user-select: none;
  transition: color 0.2s;
}

.data-table th.sortable:hover {
  color: var(--gold-400);
}

.data-table th.sortable {
  display: flex;
  align-items: center;
  gap: 6px;
}

.sort-icon {
  opacity: 0.3;
  transition: all 0.2s;
}

.sortable:hover .sort-icon,
.sortable.sorted .sort-icon {
  opacity: 1;
}

.sortable.sorted.desc .sort-icon {
  transform: rotate(180deg);
}

.data-table td {
  padding: 16px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  color: rgba(229, 231, 235, 0.9);
}

.table-row {
  transition: background 0.2s;
}

.table-row:hover {
  background: rgba(251, 191, 36, 0.03);
}

.animate-row {
  animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  opacity: 0;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.cell-date,
.cell-actor {
  font-size: 13px;
}

.date-wrapper,
.actor-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  color: rgba(229, 231, 235, 0.7);
}

.date-wrapper svg,
.actor-wrapper svg {
  opacity: 0.5;
}

.tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.tag--create {
  background: rgba(34, 197, 94, 0.15);
  color: #86efac;
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.tag--update {
  background: rgba(59, 130, 246, 0.15);
  color: #93c5fd;
  border: 1px solid rgba(59, 130, 246, 0.3);
}

.tag--delete {
  background: rgba(239, 68, 68, 0.15);
  color: #fca5a5;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.entity-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 6px;
  background: rgba(251, 191, 36, 0.1);
  color: var(--gold-300);
  font-size: 12px;
  font-weight: 600;
  text-transform: capitalize;
}

.entity-id,
.ip-address {
  font-family: "JetBrains Mono", monospace;
  font-size: 12px;
  color: rgba(229, 231, 235, 0.6);
  background: rgba(255, 255, 255, 0.05);
  padding: 4px 8px;
  border-radius: 4px;
}

.btn-details {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(255, 255, 255, 0.03);
  color: rgba(229, 231, 235, 0.7);
  font-size: 12px;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-details:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: var(--gold-400);
  color: var(--gold-300);
}

.btn-details.active svg {
  transform: rotate(180deg);
}

.details-panel {
  margin-top: 12px;
  padding: 16px;
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.08);
  animation: expandDetails 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes expandDetails {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.json-viewer {
  margin: 0;
  font-family: "JetBrains Mono", monospace;
  font-size: 12px;
  line-height: 1.6;
  color: #86efac;
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 300px;
  overflow-y: auto;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  text-align: center;
  color: rgba(229, 231, 235, 0.5);
}

.empty-state svg {
  margin-bottom: 16px;
  opacity: 0.4;
}

.empty-state p {
  margin: 0;
  font-size: 16px;
  font-weight: 500;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1024px) {
  .admin-header__content {
    flex-direction: column;
  }
  
  .charts-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .admin-console {
    padding: 24px 16px;
  }
  
  .admin-header {
    padding: 32px 24px;
  }
  
  .admin-title {
    font-size: 32px;
  }
  
  .kpi-grid {
    grid-template-columns: 1fr;
  }
  
  .filter-row {
    grid-template-columns: 1fr;
  }
  
  .table-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
}
</style>

<script>
// ===== INITIALISATION DES STYLES DEPUIS DATA-ATTRIBUTES =====
document.addEventListener('DOMContentLoaded', () => {
  // Appliquer les largeurs des barres de progression
  document.querySelectorAll('[data-width]').forEach(el => {
    const width = el.getAttribute('data-width');
    el.style.width = width + '%';
  });
  
  // Appliquer les d√©lais d'animation
  document.querySelectorAll('[data-delay]').forEach(el => {
    const delay = el.getAttribute('data-delay');
    el.style.animationDelay = delay + 's';
  });
});

// ===== ANIMATION DES COMPTEURS =====
function animateCounter(element) {
  const target = parseInt(element.getAttribute('data-target'));
  const duration = 2000;
  const increment = target / (duration / 16);
  let current = 0;
  
  const timer = setInterval(() => {
    current += increment;
    if (current >= target) {
      element.textContent = target;
      clearInterval(timer);
    } else {
      element.textContent = Math.floor(current);
    }
  }, 16);
}

// Animer tous les compteurs au chargement
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.animate-count').forEach(animateCounter);
});

// ===== TOGGLE FILTRES =====
const toggleFiltersBtn = document.getElementById('toggleFilters');
const filterContent = document.getElementById('filterContent');

if (toggleFiltersBtn && filterContent) {
  toggleFiltersBtn.addEventListener('click', (e) => {
    e.preventDefault();
    filterContent.classList.toggle('open');
    toggleFiltersBtn.classList.toggle('active');
  });
}

// ===== TRI DE TABLE =====
let currentSort = { column: null, direction: 'asc' };

document.querySelectorAll('.sortable').forEach(header => {
  header.addEventListener('click', () => {
    const column = header.getAttribute('data-sort');
    const table = document.getElementById('auditTable');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('.table-row'));
    
    // Toggle direction
    if (currentSort.column === column) {
      currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
    } else {
      currentSort.column = column;
      currentSort.direction = 'asc';
    }
    
    // Remove sorted class from all headers
    document.querySelectorAll('.sortable').forEach(h => {
      h.classList.remove('sorted', 'asc', 'desc');
    });
    
    // Add sorted class to current header
    header.classList.add('sorted', currentSort.direction);
    
    // Sort rows
    rows.sort((a, b) => {
      let aVal, bVal;
      
      switch(column) {
        case 'date':
          aVal = a.cells[0].textContent.trim();
          bVal = b.cells[0].textContent.trim();
          break;
        case 'action':
          aVal = a.cells[1].textContent.trim();
          bVal = b.cells[1].textContent.trim();
          break;
        case 'entity':
          aVal = a.cells[2].textContent.trim();
          bVal = b.cells[2].textContent.trim();
          break;
        case 'actor':
          aVal = a.cells[4].textContent.trim();
          bVal = b.cells[4].textContent.trim();
          break;
        default:
          return 0;
      }
      
      if (currentSort.direction === 'asc') {
        return aVal.localeCompare(bVal);
      } else {
        return bVal.localeCompare(aVal);
      }
    });
    
    // Reappend sorted rows
    rows.forEach(row => tbody.appendChild(row));
  });
});

// ===== TOGGLE DETAILS =====
function toggleDetails(button, index) {
  const detailsPanel = document.getElementById('details-' + index);
  const isVisible = detailsPanel.style.display !== 'none';
  
  if (isVisible) {
    detailsPanel.style.display = 'none';
    button.classList.remove('active');
  } else {
    // Fermer tous les autres d√©tails
    document.querySelectorAll('.details-panel').forEach(panel => {
      panel.style.display = 'none';
    });
    document.querySelectorAll('.btn-details').forEach(btn => {
      btn.classList.remove('active');
    });
    
    detailsPanel.style.display = 'block';
    button.classList.add('active');
  }
}

// ===== RECHERCHE EN TEMPS REEL =====
const searchInput = document.getElementById('searchInput');
if (searchInput) {
  let searchTimeout;
  searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const query = e.target.value.toLowerCase();
      const rows = document.querySelectorAll('.table-row');
      let visibleCount = 0;
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
          row.style.display = '';
          visibleCount++;
        } else {
          row.style.display = 'none';
        }
      });
      
      // Mettre √† jour le compteur
      const rowCount = document.getElementById('rowCount');
      if (rowCount) {
        rowCount.textContent = visibleCount;
      }
    }, 300);
  });
}

// ===== EXPORT CSV =====
function exportTableToCSV() {
  const table = document.getElementById('auditTable');
  const rows = table.querySelectorAll('tr');
  const csv = [];
  
  rows.forEach(row => {
    const cols = row.querySelectorAll('td, th');
    const rowData = [];
    
    cols.forEach((col, index) => {
      // Ignorer la colonne des d√©tails
      if (index < cols.length - 1) {
        let text = col.textContent.trim();
        // √âchapper les guillemets
        text = text.replace(/"/g, '""');
        rowData.push('"' + text + '"');
      }
    });
    
    if (rowData.length > 0) {
      csv.push(rowData.join(','));
    }
  });
  
  // Cr√©er le fichier et le t√©l√©charger
  const csvContent = csv.join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  
  link.setAttribute('href', url);
  link.setAttribute('download', 'audit_logs_' + new Date().toISOString().split('T')[0] + '.csv');
  link.style.visibility = 'hidden';
  
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  // Notification de succ√®s
  showNotification('Export CSV r√©ussi !', 'success');
}

// ===== NOTIFICATIONS =====
function showNotification(message, type = 'info') {
  // Cr√©er le conteneur de notifications s'il n'existe pas
  let container = document.getElementById('notification-container');
  if (!container) {
    container = document.createElement('div');
    container.id = 'notification-container';
    container.style.cssText = `
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
      pointer-events: none;
    `;
    document.body.appendChild(container);
  }
  
  // Cr√©er la notification
  const notification = document.createElement('div');
  notification.style.cssText = `
    padding: 16px 24px;
    border-radius: 12px;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#fbbf24'};
    color: ${type === 'success' ? '#86efac' : type === 'error' ? '#fca5a5' : '#fde68a'};
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    font-size: 14px;
    font-weight: 600;
    pointer-events: auto;
    animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  `;
  notification.textContent = message;
  
  container.appendChild(notification);
  
  // Supprimer apr√®s 3 secondes
  setTimeout(() => {
    notification.style.animation = 'slideOutRight 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    setTimeout(() => {
      notification.remove();
      if (container.children.length === 0) {
        container.remove();
      }
    }, 300);
  }, 3000);
}

// Ajouter les animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(100px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  @keyframes slideOutRight {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(100px);
    }
  }
`;
document.head.appendChild(style);

// ===== KEYBOARD SHORTCUTS =====
document.addEventListener('keydown', (e) => {
  // Ctrl/Cmd + K : Focus sur la recherche
  if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
    e.preventDefault();
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
      searchInput.focus();
      searchInput.select();
    }
  }
  
  // Ctrl/Cmd + E : Export CSV
  if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
    e.preventDefault();
    exportTableToCSV();
  }
  
  // Ctrl/Cmd + F : Toggle filtres
  if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
    e.preventDefault();
    if (toggleFiltersBtn) {
      toggleFiltersBtn.click();
    }
  }
});

// ===== SCROLL EFFECTS =====
let lastScroll = 0;
window.addEventListener('scroll', () => {
  const currentScroll = window.pageYOffset;
  
  // Ajouter une classe au header quand on scroll
  const header = document.querySelector('.admin-header');
  if (header) {
    if (currentScroll > 100) {
      header.style.transform = 'scale(0.98)';
      header.style.opacity = '0.9';
    } else {
      header.style.transform = 'scale(1)';
      header.style.opacity = '1';
    }
  }
  
  lastScroll = currentScroll;
});

// ===== HOVER EFFECTS SUR LES KPI CARDS =====
document.querySelectorAll('.kpi-card').forEach(card => {
  card.addEventListener('mousemove', (e) => {
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;
    
    const rotateX = (y - centerY) / 20;
    const rotateY = (centerX - x) / 20;
    
    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-4px)`;
  });
  
  card.addEventListener('mouseleave', () => {
    card.style.transform = '';
  });
});

// Message de bienvenue
console.log('%cüé∞ Console Admin Casinooooooo', 'font-size: 24px; font-weight: bold; color: #fbbf24; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);');
console.log('%cRaccourcis clavier:', 'font-size: 14px; font-weight: bold; color: #3b82f6;');
console.log('%c‚Ä¢ Ctrl/Cmd + K : Rechercher', 'font-size: 12px; color: #86efac;');
console.log('%c‚Ä¢ Ctrl/Cmd + E : Exporter en CSV', 'font-size: 12px; color: #86efac;');
console.log('%c‚Ä¢ Ctrl/Cmd + F : Afficher/masquer les filtres', 'font-size: 12px; color: #86efac;');
</script>

<%- include('partials/footer') %>
