<%- include('partials/header') %>
<%- include('partials/nav') %>

<div class="container">
  <h2>Entreprises</h2>

  <!-- Formulaire d'ajout (uniquement connecté) -->
  <% if (user) { %>
    <div class="card wide">
      <h3>Ajouter une entreprise</h3>
      <form method="post" action="/entreprises">
        <input name="nomEntreprise" placeholder="Nom entreprise" required />
        <div class="row">
          <input name="contactNom" placeholder="Contact nom (optionnel)" />
          <input name="contactEmail" placeholder="Contact email (optionnel)" />
        </div>
        <input name="notes" placeholder="Notes (optionnel)" />
        <button class="btn" type="submit">Ajouter</button>
      </form>
    </div>
  <% } %>

  <!-- Liste des entreprises -->
  <div style="margin-top: 20px;">
    <h3>Entreprises (<span id="count"><%= items.length %></span>)</h3>
    <div class="list" id="empresasContainer">
      <% if (items.length === 0) { %>
        <p style="text-align: center; color: #666;">Aucune entreprise enregistrée</p>
      <% } else { %>
        <% items.forEach(item => { %>
          <div class="item">
            <div style="flex:1">
              <b><%= item.nomEntreprise %></b>
              <div class="muted"><%= item.contactNom || '—' %> · <%= item.contactEmail || '—' %></div>
              <div class="muted"><%= item.notes || '' %></div>
            </div>

            <% if (user) { %>
              <form method="post" action="/entreprises/<%= item._id %>/delete">
                <button class="btn danger small" type="submit">Supprimer</button>
              </form>
            <% } %>
          </div>
        <% }) %>
      <% } %>
    </div>
  </div>

  <!-- Message pour utilisateurs déconnectés -->
  <% if (!user) { %>
    <div style="background-color: #f0f0f0; padding: 15px; border-radius: 4px; margin-top: 20px; text-align: center; color: #666;">
      <p>Connectez-vous pour ajouter ou supprimer des entreprises</p>
      <a href="/login" class="btn">Se connecter</a>
    </div>
  <% } %>
</div>

</body></html>
